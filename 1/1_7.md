# 1.7 协议层次及服务模型

|   5层Internet协议栈   |
| :-------------------: |
| 应用层 HTTP,FTP,DNS.. |
|    运输层 TCP,UDP     |
|       网络层 IP       |
|        链路层         |
|        物理层         |

## 协议层次

### 分层处理的好处

网络是一个相当复杂的系统

实现一个复杂的系统往往有两种方式：

- 模块化
- 分层

区别是模块化允许相互调用，层次化则只允许相邻的层进行调用

互联网采用分层处理的设计，好处：

- 复杂问题分解为单一简单清晰的子问题
- 改变某一层服务的实现不影响系统的其他层次

坏处：

- 分层实现的效率低于一起实现的效率

### 层次化类比

//图

### 层次化实现复杂网络功能

- 每层实现明确的功能
  - 通过借助下层服务(接口)并执行某些协议实体的相互动作实现
  - 目的是为上层提供更好的服务
  - 有可能利用软硬件相结合的方式实现(应用和传输层是纯软件，网络层常有软硬件相结合)
- 上层服务集合$$\supsetneqq$$下层服务集合
  - 很显然下层的服务，上层都可以直接调用下层接口以实现
  - 如果上层所能提供的服务集合与下层相同，很显然这层就没有存在的意义了

## 服务和服务访问点

- 服务(Service)：低层实体为上层实体提供它与另一个上层实体之间通信的能力

  - 服务用户(service user)
- 服务提供者(service provider)
- 原语(primitive)：上层使用下层服务的形式，下层为上层提供了哪些服务 (类似不同的API接口)(为了区分不同的服务)
- 服务访问点(Service Access Point,SAP)：SAP可以标记不同的上层实体(为了区分不同的服务用户)
  - 例子：传输层SAP：端口(port)
  - 可以有不同的实现，如队列

### 服务的分类

- 面向连接的服务
  - 建立连接，通信，拆除连接
  - 适用：大数据块，不适合小的零星报文
  - 特点(不尽然)：保序
  - 服务类型
    - 可靠的信息流 传送页面
    - 可靠的字节流 远程登录
    - 不可靠的连接 数字化声音

- 无连接服务
  - 无需建立连接，预留资源，不需要通信双方都活跃
  - 特点(不尽然)：不可靠，可能重复，失序...
  - 适用：零星数据
  - 服务类型
    - 不可靠的数据报 电子方式的函件
    - 有确认的数据报 挂号信
    - 请求回答 信息查询

### 服务和协议

- 服务：
  - 垂直
  - 下层为上层提供服务
  - 通过原语操作
- 协议(protocol)
  - 水平
  - 对等实体在相互通信时，需要遵守的规则集合

联系：

- 本层协议实现依赖下层服务
- 本层实体通过协议为上层提供更好的服务

## 数据单元(DU)

//图

(中科大PPT与我在网上所查稍有出入，我以网上的为准)

在每一层每一个分组都有两种类型的字段：首部字段(header)和有效载荷子段

header中含有控制信息，可能还会有地址信息等

SDU：服务数据单元（上层给我的，他希望我传递这个信息）

ICI：接口控制信息（上层给我的控制信息）

PCI：协议控制信息

PDU(这个最重要)：协议数据单元，我想要传给对等协议层的数据单元（含控制信息和用户信息）



PDU等于本层Header+SDU(+可能有的尾部)，本层可能对SDU进行重新编码/转化/拆分等。

本层的PDU在下一层眼里就是SDU，本层的PCI在下一层眼里就是ICI



下一层会收到我**封装**好的PDU，以及我根据他的接口给出的PCI

(当本层收到一个PDU时，我也会将PDU**解封装**出SDU，然后传递给上一层)



其中，根据上层传来的信息，我们有三种方式组成本层的PDU

//41图



//封装图

## 协议栈与各层PDU

应用层

- 为人类或者其他应用进程提供网络应用服务
- 报文(message)

传输层：

- 提供**进程到进程**的通信服务，TCP把不可靠通信变为可靠通信
- 报文段(segment)：TCP段，UDP数据报

网络层

- 提供**端到端**的通信服务，不可靠
- 分组packet(无连接方式也叫：数据报datagram)

链路层

- 相邻两点间的通信服务，可靠/不可靠
- 帧(frame)

物理层

- 在物理媒体上传输bit
- 位(bit)(比较含糊，不同的物理媒体各有不同叫法)

## OSI

| 7层OSI模型 |
| :--------: |
|   应用层   |
| **表示层** |
| **会话层** |
|   传输层   |
|   网络层   |
|   链路层   |
|   物理层   |

- 表示层：允许应用解释传输的数据
  - 加密，压缩等

- 会话层：数据交换的同步，检查点，恢复



因特网缺少了这两层，实际上，这两层留给应用开发者处理，如果他觉得重要，就构建这个功能(比如加密)
